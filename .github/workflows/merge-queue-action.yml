name: Merge-Queue-Trigger

on:
  merge_group:

jobs:
  trigger-review-bot:
    runs-on: ubuntu-latest
    env: master
    name: trigger review bot
    steps:
      - name: Generate token
        id: app_token
        uses: tibdex/github-app-token@v1
        with:
          app_id: ${{ secrets.REVIEW_APP_ID }}
          private_key: ${{ secrets.REVIEW_APP_KEY }}
      - run: echo "Running with commit $ID"
        env:
          ID: ${{ github.event.merge_group.head_commit.id }}
      - name: Add Merge Queue status check
        uses: billyjbryant/create-status-check@v2
        with:
          authToken: ${{ steps.app_token.outputs.token }}
          context: 'review-bot'
          description: 'PRs for merge queue gets approved'
          state: 'success'
          sha: ${{ github.event.merge_group.head_commit.id }}
